{"ast":null,"code":"import { Api } from \"./api\";\nimport { getGeneralApiProblem } from \"./api/api-problem\";\nexport class AuthApi extends Api {\n  async login(username, password) {\n    const response = await this.apisauce.post(\"/api/v1/auth/login\", {\n      username: username,\n      password: password\n    });\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response);\n      if (problem) return problem;\n    }\n    try {\n      const data = response.data;\n      return {\n        kind: \"ok\",\n        token: data.auth_token,\n        user: data.user\n      };\n    } catch {\n      return {\n        kind: \"bad-data\"\n      };\n    }\n  }\n  async fetchStatus(token) {\n    this.apisauce.setHeader(\"Authorization\", `Bearer ${token}`);\n    const response = await this.apisauce.get(\"/api/v1/auth/status\");\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response);\n      if (problem) return problem;\n    }\n    try {\n      const data = response.data;\n      return {\n        kind: \"ok\",\n        user: data.user\n      };\n    } catch {\n      return {\n        kind: \"bad-data\"\n      };\n    }\n  }\n  async checkToken(token) {\n    this.apisauce.setHeader(\"Authorization\", `Bearer ${token}`);\n    const response = await this.apisauce.get(\"/api/v1/auth/ping\");\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response);\n      if (problem) return problem;\n    }\n    try {\n      const data = response.data;\n      return {\n        kind: \"ok\",\n        message: data.message\n      };\n    } catch {\n      return {\n        kind: \"bad-data\"\n      };\n    }\n  }\n}","map":{"version":3,"names":["Api","getGeneralApiProblem","AuthApi","login","username","password","response","apisauce","post","ok","problem","data","kind","token","auth_token","user","fetchStatus","setHeader","get","checkToken","message"],"sources":["/usr/src/app/services/auth.ts"],"sourcesContent":["import { Api } from \"./api\";\nimport { ApiResponse } from \"apisauce\";\nimport { GeneralApiProblem, getGeneralApiProblem } from \"./api/api-problem\";\nimport { User } from \"./types\";\n\nexport type AuthResponse =\n  | { kind: \"ok\"; token: string; user: User }\n  | GeneralApiProblem;\nexport type UserStatusResponse = { kind: \"ok\"; user: User } | GeneralApiProblem;\nexport type GeneralStatusResponse =\n  | { kind: \"ok\"; message: string }\n  | GeneralApiProblem;\n\nexport class AuthApi extends Api {\n  async login(username: string, password: string): Promise<AuthResponse> {\n    const response: ApiResponse<any> = await this.apisauce.post(\n      \"/api/v1/auth/login\",\n      {\n        username: username,\n        password: password\n      }\n    );\n\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response);\n      if (problem) return problem;\n    }\n\n    try {\n      const data = response.data;\n      return { kind: \"ok\", token: data.auth_token, user: data.user };\n    } catch {\n      return { kind: \"bad-data\" };\n    }\n  }\n\n  async fetchStatus(token: string): Promise<UserStatusResponse> {\n    this.apisauce.setHeader(\"Authorization\", `Bearer ${token}`);\n    const response: ApiResponse<any> = await this.apisauce.get(\n      \"/api/v1/auth/status\"\n    );\n\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response);\n      if (problem) return problem;\n    }\n\n    try {\n      const data = response.data;\n      return { kind: \"ok\", user: data.user };\n    } catch {\n      return { kind: \"bad-data\" };\n    }\n  }\n\n  async checkToken(token: string): Promise<GeneralStatusResponse> {\n    this.apisauce.setHeader(\"Authorization\", `Bearer ${token}`);\n    const response: ApiResponse<any> = await this.apisauce.get(\n      \"/api/v1/auth/ping\"\n    );\n\n    if (!response.ok) {\n      const problem = getGeneralApiProblem(response);\n      if (problem) return problem;\n    }\n\n    try {\n      const data = response.data;\n      return { kind: \"ok\", message: data.message };\n    } catch {\n      return { kind: \"bad-data\" };\n    }\n  }\n}\n"],"mappings":"AAAA,SAASA,GAAG,QAAQ,OAAO;AAE3B,SAA4BC,oBAAoB,QAAQ,mBAAmB;AAW3E,OAAO,MAAMC,OAAO,SAASF,GAAG,CAAC;EAC/B,MAAMG,KAAKA,CAACC,QAAgB,EAAEC,QAAgB,EAAyB;IACrE,MAAMC,QAA0B,GAAG,MAAM,IAAI,CAACC,QAAQ,CAACC,IAAI,CACzD,oBAAoB,EACpB;MACEJ,QAAQ,EAAEA,QAAQ;MAClBC,QAAQ,EAAEA;IACZ,CACF,CAAC;IAED,IAAI,CAACC,QAAQ,CAACG,EAAE,EAAE;MAChB,MAAMC,OAAO,GAAGT,oBAAoB,CAACK,QAAQ,CAAC;MAC9C,IAAII,OAAO,EAAE,OAAOA,OAAO;IAC7B;IAEA,IAAI;MACF,MAAMC,IAAI,GAAGL,QAAQ,CAACK,IAAI;MAC1B,OAAO;QAAEC,IAAI,EAAE,IAAI;QAAEC,KAAK,EAAEF,IAAI,CAACG,UAAU;QAAEC,IAAI,EAAEJ,IAAI,CAACI;MAAK,CAAC;IAChE,CAAC,CAAC,MAAM;MACN,OAAO;QAAEH,IAAI,EAAE;MAAW,CAAC;IAC7B;EACF;EAEA,MAAMI,WAAWA,CAACH,KAAa,EAA+B;IAC5D,IAAI,CAACN,QAAQ,CAACU,SAAS,CAAC,eAAe,EAAG,UAASJ,KAAM,EAAC,CAAC;IAC3D,MAAMP,QAA0B,GAAG,MAAM,IAAI,CAACC,QAAQ,CAACW,GAAG,CACxD,qBACF,CAAC;IAED,IAAI,CAACZ,QAAQ,CAACG,EAAE,EAAE;MAChB,MAAMC,OAAO,GAAGT,oBAAoB,CAACK,QAAQ,CAAC;MAC9C,IAAII,OAAO,EAAE,OAAOA,OAAO;IAC7B;IAEA,IAAI;MACF,MAAMC,IAAI,GAAGL,QAAQ,CAACK,IAAI;MAC1B,OAAO;QAAEC,IAAI,EAAE,IAAI;QAAEG,IAAI,EAAEJ,IAAI,CAACI;MAAK,CAAC;IACxC,CAAC,CAAC,MAAM;MACN,OAAO;QAAEH,IAAI,EAAE;MAAW,CAAC;IAC7B;EACF;EAEA,MAAMO,UAAUA,CAACN,KAAa,EAAkC;IAC9D,IAAI,CAACN,QAAQ,CAACU,SAAS,CAAC,eAAe,EAAG,UAASJ,KAAM,EAAC,CAAC;IAC3D,MAAMP,QAA0B,GAAG,MAAM,IAAI,CAACC,QAAQ,CAACW,GAAG,CACxD,mBACF,CAAC;IAED,IAAI,CAACZ,QAAQ,CAACG,EAAE,EAAE;MAChB,MAAMC,OAAO,GAAGT,oBAAoB,CAACK,QAAQ,CAAC;MAC9C,IAAII,OAAO,EAAE,OAAOA,OAAO;IAC7B;IAEA,IAAI;MACF,MAAMC,IAAI,GAAGL,QAAQ,CAACK,IAAI;MAC1B,OAAO;QAAEC,IAAI,EAAE,IAAI;QAAEQ,OAAO,EAAET,IAAI,CAACS;MAAQ,CAAC;IAC9C,CAAC,CAAC,MAAM;MACN,OAAO;QAAER,IAAI,EAAE;MAAW,CAAC;IAC7B;EACF;AACF"},"metadata":{},"sourceType":"module"}