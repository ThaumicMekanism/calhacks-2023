{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.getEventSourceWrapper = getEventSourceWrapper;\nvar eventCallbacks = [];\nfunction EventSourceWrapper(options) {\n  var source;\n  var lastActivity = new Date();\n  var listeners = [];\n  if (!options.timeout) {\n    options.timeout = 20 * 1000;\n  }\n  init();\n  var timer = setInterval(function () {\n    if (new Date() - lastActivity > options.timeout) {\n      handleDisconnect();\n    }\n  }, options.timeout / 2);\n  function init() {\n    source = new window.EventSource(options.path);\n    source.onopen = handleOnline;\n    source.onerror = handleDisconnect;\n    source.onmessage = handleMessage;\n  }\n  function handleOnline() {\n    if (options.log) console.log('[HMR] connected');\n    lastActivity = new Date();\n  }\n  function handleMessage(event) {\n    lastActivity = new Date();\n    for (var i = 0; i < listeners.length; i++) {\n      listeners[i](event);\n    }\n    eventCallbacks.forEach(function (cb) {\n      if (!cb.unfiltered && event.data.indexOf('action') === -1) return;\n      cb(event);\n    });\n  }\n  function handleDisconnect() {\n    clearInterval(timer);\n    source.close();\n    setTimeout(init, options.timeout);\n  }\n  return {\n    close: function close() {\n      clearInterval(timer);\n      source.close();\n    },\n    addMessageListener: function addMessageListener(fn) {\n      listeners.push(fn);\n    }\n  };\n}\n_c = EventSourceWrapper;\nfunction getEventSourceWrapper(options) {\n  if (!options.ondemand) {\n    return {\n      addMessageListener: function addMessageListener(cb) {\n        eventCallbacks.push(cb);\n      }\n    };\n  }\n  return EventSourceWrapper(options);\n}\nvar _c;\n$RefreshReg$(_c, \"EventSourceWrapper\");","map":{"version":3,"sources":["../../../../client/dev/error-overlay/eventsource.js"],"names":["eventCallbacks","EventSourceWrapper","options","source","lastActivity","Date","listeners","timeout","init","timer","setInterval","handleDisconnect","window","EventSource","path","onopen","handleOnline","onerror","onmessage","handleMessage","log","console","event","i","length","forEach","cb","unfiltered","data","indexOf","clearInterval","close","setTimeout","addMessageListener","fn","push","getEventSourceWrapper","ondemand"],"mappings":";;;;AAAA,IAAMA,cAAc,GAAG,EAAvB;AAEA,SAASC,kBAAT,CAA4BC,OAA5B,EAAqC;EACnC,IAAIC,MAAJ;EACA,IAAIC,YAAY,GAAG,IAAIC,IAAJ,CAAA,CAAnB;EACA,IAAIC,SAAS,GAAG,EAAhB;EAEA,IAAI,CAACJ,OAAO,CAACK,OAAb,EAAsB;IACpBL,OAAO,CAACK,OAARL,GAAkB,EAAA,GAAK,IAAvBA;EACD;EAEDM,IAAI,CAAA,CAAA;EACJ,IAAIC,KAAK,GAAGC,WAAW,CAAC,YAAY;IAClC,IAAI,IAAIL,IAAJ,CAAA,CAAA,GAAaD,YAAb,GAA4BF,OAAO,CAACK,OAAxC,EAAiD;MAC/CI,gBAAgB,CAAA,CAAA;IACjB;EACF,CAJsB,EAIpBT,OAAO,CAACK,OAARL,GAAkB,CAJE,CAAvB;EAMA,SAASM,IAAT,CAAA,EAAgB;IACdL,MAAM,GAAG,IAAIS,MAAM,CAACC,WAAX,CAAuBX,OAAO,CAACY,IAA/B,CAATX;IACAA,MAAM,CAACY,MAAPZ,GAAgBa,YAAhBb;IACAA,MAAM,CAACc,OAAPd,GAAiBQ,gBAAjBR;IACAA,MAAM,CAACe,SAAPf,GAAmBgB,aAAnBhB;EACD;EAED,SAASa,YAAT,CAAA,EAAwB;IACtB,IAAId,OAAO,CAACkB,GAAZ,EAAiBC,OAAO,CAACD,GAARC,CAAY,iBAAZA,CAAAA;IACjBjB,YAAY,GAAG,IAAIC,IAAJ,CAAA,CAAfD;EACD;EAED,SAASe,aAAT,CAAuBG,KAAvB,EAA8B;IAC5BlB,YAAY,GAAG,IAAIC,IAAJ,CAAA,CAAfD;IACA,KAAK,IAAImB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjB,SAAS,CAACkB,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;MACzCjB,SAAS,CAACiB,CAAD,CAATjB,CAAagB,KAAbhB,CAAAA;IACD;IAEDN,cAAc,CAACyB,OAAfzB,CAAwB0B,UAAAA,EAAD,EAAQ;MAC7B,IAAI,CAACA,EAAE,CAACC,UAAJ,IAAkBL,KAAK,CAACM,IAANN,CAAWO,OAAXP,CAAmB,QAAnBA,CAAAA,KAAiC,CAAC,CAAxD,EAA2D;MAC3DI,EAAE,CAACJ,KAAD,CAAFI;IACD,CAHD1B,CAAAA;EAID;EAED,SAASW,gBAAT,CAAA,EAA4B;IAC1BmB,aAAa,CAACrB,KAAD,CAAbqB;IACA3B,MAAM,CAAC4B,KAAP5B,CAAAA,CAAAA;IACA6B,UAAU,CAACxB,IAAD,EAAON,OAAO,CAACK,OAAf,CAAVyB;EACD;EAED,OAAO;IACLD,KAAK,EAAE,SAAA,MAAA,EAAM;MACXD,aAAa,CAACrB,KAAD,CAAbqB;MACA3B,MAAM,CAAC4B,KAAP5B,CAAAA,CAAAA;IACD,CAJI;IAKL8B,kBAAkB,EAAE,SAAA,mBAAUC,EAAV,EAAc;MAChC5B,SAAS,CAAC6B,IAAV7B,CAAe4B,EAAf5B,CAAAA;IACD;EAPI,CAAP;AASD;AAEM,EAAA,GAzDEL,kBAAT;AAyDO,SAASmC,qBAAT,CAA+BlC,OAA/B,EAAwC;EAC7C,IAAI,CAACA,OAAO,CAACmC,QAAb,EAAuB;IACrB,OAAO;MACLJ,kBAAkB,EAAGP,SAAAA,mBAAAA,EAAD,EAAQ;QAC1B1B,cAAc,CAACmC,IAAfnC,CAAoB0B,EAApB1B,CAAAA;MACD;IAHI,CAAP;EAKD;EACD,OAAOC,kBAAkB,CAACC,OAAD,CAAzB;AACD;AAAA,IAAA,EAAA;AAAA,YAAA,CAAA,EAAA","sourcesContent":["const eventCallbacks = []\n\nfunction EventSourceWrapper(options) {\n  var source\n  var lastActivity = new Date()\n  var listeners = []\n\n  if (!options.timeout) {\n    options.timeout = 20 * 1000\n  }\n\n  init()\n  var timer = setInterval(function () {\n    if (new Date() - lastActivity > options.timeout) {\n      handleDisconnect()\n    }\n  }, options.timeout / 2)\n\n  function init() {\n    source = new window.EventSource(options.path)\n    source.onopen = handleOnline\n    source.onerror = handleDisconnect\n    source.onmessage = handleMessage\n  }\n\n  function handleOnline() {\n    if (options.log) console.log('[HMR] connected')\n    lastActivity = new Date()\n  }\n\n  function handleMessage(event) {\n    lastActivity = new Date()\n    for (var i = 0; i < listeners.length; i++) {\n      listeners[i](event)\n    }\n\n    eventCallbacks.forEach((cb) => {\n      if (!cb.unfiltered && event.data.indexOf('action') === -1) return\n      cb(event)\n    })\n  }\n\n  function handleDisconnect() {\n    clearInterval(timer)\n    source.close()\n    setTimeout(init, options.timeout)\n  }\n\n  return {\n    close: () => {\n      clearInterval(timer)\n      source.close()\n    },\n    addMessageListener: function (fn) {\n      listeners.push(fn)\n    },\n  }\n}\n\nexport function getEventSourceWrapper(options) {\n  if (!options.ondemand) {\n    return {\n      addMessageListener: (cb) => {\n        eventCallbacks.push(cb)\n      },\n    }\n  }\n  return EventSourceWrapper(options)\n}\n"]},"metadata":{},"sourceType":"script"}