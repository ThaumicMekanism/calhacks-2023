{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports.useRouter = useRouter;\nexports.makePublicRouterInstance = makePublicRouterInstance;\nexports.createRouter = exports.withRouter = exports.default = void 0;\nvar _react = _interopRequireDefault(require(\"react\"));\nvar _router2 = _interopRequireWildcard(require(\"../next-server/lib/router/router\"));\nexports.Router = _router2.default;\nexports.NextRouter = _router2.NextRouter;\nvar _routerContext = require(\"../next-server/lib/router-context\");\nvar _withRouter = _interopRequireDefault(require(\"./with-router\"));\nexports.withRouter = _withRouter.default; /* global window */\nconst singletonRouter = {\n  router: null,\n  // holds the actual router instance\n  readyCallbacks: [],\n  ready(cb) {\n    if (this.router) return cb();\n    if (false) {\n      this.readyCallbacks.push(cb);\n    }\n  }\n}; // Create public properties and methods of the router in the singletonRouter\nconst urlPropertyFields = ['pathname', 'route', 'query', 'asPath', 'components', 'isFallback', 'basePath', 'locale', 'locales', 'defaultLocale'];\nconst routerEvents = ['routeChangeStart', 'beforeHistoryChange', 'routeChangeComplete', 'routeChangeError', 'hashChangeStart', 'hashChangeComplete'];\nconst coreMethodFields = ['push', 'replace', 'reload', 'back', 'prefetch', 'beforePopState']; // Events is a static property on the router, the router doesn't have to be initialized to use it\nObject.defineProperty(singletonRouter, 'events', {\n  get() {\n    return _router2.default.events;\n  }\n});\nurlPropertyFields.forEach(field => {\n  // Here we need to use Object.defineProperty because, we need to return\n  // the property assigned to the actual router\n  // The value might get changed as we change routes and this is the\n  // proper way to access it\n  Object.defineProperty(singletonRouter, field, {\n    get() {\n      const router = getRouter();\n      return router[field];\n    }\n  });\n});\ncoreMethodFields.forEach(field => {\n  // We don't really know the types here, so we add them later instead\n  ;\n  singletonRouter[field] = (...args) => {\n    const router = getRouter();\n    return router[field](...args);\n  };\n});\nrouterEvents.forEach(event => {\n  singletonRouter.ready(() => {\n    _router2.default.events.on(event, (...args) => {\n      const eventField = `on${event.charAt(0).toUpperCase()}${event.substring(1)}`;\n      const _singletonRouter = singletonRouter;\n      if (_singletonRouter[eventField]) {\n        try {\n          _singletonRouter[eventField](...args);\n        } catch (err) {\n          console.error(`Error when running the Router event: ${eventField}`);\n          console.error(`${err.message}\\n${err.stack}`);\n        }\n      }\n    });\n  });\n});\nfunction getRouter() {\n  if (!singletonRouter.router) {\n    const message = 'No router instance found.\\n' + 'You should only use \"next/router\" inside the client side of your app.\\n';\n    throw new Error(message);\n  }\n  return singletonRouter.router;\n} // Export the singletonRouter and this is the public API.\nvar _default = singletonRouter; // Reexport the withRoute HOC\nexports.default = _default;\nfunction useRouter() {\n  return _react.default.useContext(_routerContext.RouterContext);\n} // INTERNAL APIS\n// -------------\n// (do not use following exports inside the app)\n// Create a router and assign it as the singleton instance.\n// This is used in client side when we are initilizing the app.\n// This should **not** use inside the server.\nconst createRouter = (...args) => {\n  singletonRouter.router = new _router2.default(...args);\n  singletonRouter.readyCallbacks.forEach(cb => cb());\n  singletonRouter.readyCallbacks = [];\n  return singletonRouter.router;\n}; // This function is used to create the `withRouter` router instance\nexports.createRouter = createRouter;\nfunction makePublicRouterInstance(router) {\n  const _router = router;\n  const instance = {};\n  for (const property of urlPropertyFields) {\n    if (typeof _router[property] === 'object') {\n      instance[property] = Object.assign(Array.isArray(_router[property]) ? [] : {}, _router[property]); // makes sure query is not stateful\n      continue;\n    }\n    instance[property] = _router[property];\n  } // Events is a static property on the router, the router doesn't have to be initialized to use it\n  instance.events = _router2.default.events;\n  coreMethodFields.forEach(field => {\n    instance[field] = (...args) => {\n      return _router[field](...args);\n    };\n  });\n  return instance;\n}","map":{"version":3,"sources":["../../client/router.ts"],"names":["singletonRouter","router","readyCallbacks","ready","cb","push","urlPropertyFields","routerEvents","coreMethodFields","Object","defineProperty","get","Router","events","forEach","field","getRouter","args","event","on","eventField","charAt","toUpperCase","substring","_singletonRouter","err","console","error","message","stack","Error","useRouter","React","useContext","RouterContext","createRouter","makePublicRouterInstance","_router","instance","property","assign","Array","isArray"],"mappings":";;;;;;;;AACA,IAAA,MAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,CAAA;AACA,IAAA,QAAA,GAAA,uBAAA,CAAA,OAAA,CAAA,kCAAA,CAAA,CAAA;;;AACA,IAAA,cAAA,GAAA,OAAA,CAAA,mCAAA,CAAA;AAsHA,IAAA,WAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,eAAA,CAAA,CAAA;yCAzHA;AAmBA,MAAMA,eAAoC,GAAG;EAC3CC,MAAM,EAAE,IADmC;EAC7B;EACdC,cAAc,EAAE,EAF2B;EAG3CC,KAAK,CAACC,EAAD,EAAiB;IACpB,IAAI,IAAA,CAAKH,MAAT,EAAiB,OAAOG,EAAE,CAAA,CAAT;IACjB,WAAmC;MACjC,IAAA,CAAKF,cAAL,CAAoBG,IAApB,CAAyBD,EAAzB,CAAA;IACD;EACF;AAR0C,CAA7C,CAWA;AACA,MAAME,iBAAiB,GAAG,CACxB,UADwB,EAExB,OAFwB,EAGxB,OAHwB,EAIxB,QAJwB,EAKxB,YALwB,EAMxB,YANwB,EAOxB,UAPwB,EAQxB,QARwB,EASxB,SATwB,EAUxB,eAVwB,CAA1B;AAYA,MAAMC,YAAY,GAAG,CACnB,kBADmB,EAEnB,qBAFmB,EAGnB,qBAHmB,EAInB,kBAJmB,EAKnB,iBALmB,EAMnB,oBANmB,CAArB;AAQA,MAAMC,gBAAgB,GAAG,CACvB,MADuB,EAEvB,SAFuB,EAGvB,QAHuB,EAIvB,MAJuB,EAKvB,UALuB,EAMvB,gBANuB,CAAzB,CASA;AACAC,MAAM,CAACC,cAAPD,CAAsBT,eAAtBS,EAAuC,QAAvCA,EAAiD;EAC/CE,GAAG,CAAA,EAAG;IACJ,OAAOC,QAAAA,CAAAA,OAAAA,CAAOC,MAAd;EACD;AAH8C,CAAjDJ,CAAAA;AAMAH,iBAAiB,CAACQ,OAAlBR,CAA2BS,KAAD,IAAW;EACnC;EACA;EACA;EACA;EACAN,MAAM,CAACC,cAAPD,CAAsBT,eAAtBS,EAAuCM,KAAvCN,EAA8C;IAC5CE,GAAG,CAAA,EAAG;MACJ,MAAMV,MAAM,GAAGe,SAAS,CAAA,CAAxB;MACA,OAAOf,MAAM,CAACc,KAAD,CAAb;IACD;EAJ2C,CAA9CN,CAAAA;AAMD,CAXDH,CAAAA;AAaA,gBAAgB,CAACQ,OAAjB,CAA0BC,KAAD,IAAW;EAClC;EACA;EAAEf,eAAD,CAAyBe,KAAzB,CAAA,GAAkC,CAAC,GAAGE,IAAJ,KAAoB;IACrD,MAAMhB,MAAM,GAAGe,SAAS,CAAA,CAAxB;IACA,OAAOf,MAAM,CAACc,KAAD,CAANd,CAAc,GAAGgB,IAAjBhB,CAAP;EACD,CAHA;AAIF,CAND,CAAA;AAQAM,YAAY,CAACO,OAAbP,CAAsBW,KAAD,IAAW;EAC9BlB,eAAe,CAACG,KAAhBH,CAAsB,MAAM;IAC1BY,QAAAA,CAAAA,OAAAA,CAAOC,MAAPD,CAAcO,EAAdP,CAAiBM,KAAjBN,EAAwB,CAAC,GAAGK,IAAJ,KAAa;MACnC,MAAMG,UAAU,GAAI,KAAIF,KAAK,CAACG,MAANH,CAAa,CAAbA,CAAAA,CAAgBI,WAAhBJ,CAAAA,CAA8B,GAAEA,KAAK,CAACK,SAANL,CACtD,CADsDA,CAEtD,EAFF;MAGA,MAAMM,gBAAgB,GAAGxB,eAAzB;MACA,IAAIwB,gBAAgB,CAACJ,UAAD,CAApB,EAAkC;QAChC,IAAI;UACFI,gBAAgB,CAACJ,UAAD,CAAhBI,CAA6B,GAAGP,IAAhCO,CAAAA;QACD,CAAC,QAAOC,GAAP,EAAY;UACZC,OAAO,CAACC,KAARD,CAAe,wCAAuCN,UAAW,EAAjEM,CAAAA;UACAA,OAAO,CAACC,KAARD,CAAe,GAAED,GAAG,CAACG,OAAQ,KAAIH,GAAG,CAACI,KAAM,EAA3CH,CAAAA;QACD;MACF;IACF,CAbDd,CAAAA;EAcD,CAfDZ,CAAAA;AAgBD,CAjBDO,CAAAA;AAmBA,SAASS,SAAT,CAAA,EAA6B;EAC3B,IAAI,CAAChB,eAAe,CAACC,MAArB,EAA6B;IAC3B,MAAM2B,OAAO,GACX,6BAAA,GACA,yEAFF;IAGA,MAAM,IAAIE,KAAJ,CAAUF,OAAV,CAAN;EACD;EACD,OAAO5B,eAAe,CAACC,MAAvB;AACD,CAED;eACeD,e,CAEf;;AAGO,SAAS+B,SAAT,CAAA,EAAiC;EACtC,OAAOC,MAAAA,CAAAA,OAAAA,CAAMC,UAAND,CAAiBE,cAAAA,CAAAA,aAAjBF,CAAP;AACD,CAED;AACA;AACA;AAEA;AACA;AACA;AACO,MAAMG,YAAY,GAAG,CAAC,GAAGlB,IAAJ,KAAiC;EAC3DjB,eAAe,CAACC,MAAhBD,GAAyB,IAAIY,QAAAA,CAAAA,OAAJ,CAAW,GAAGK,IAAd,CAAzBjB;EACAA,eAAe,CAACE,cAAhBF,CAA+Bc,OAA/Bd,CAAwCI,EAAD,IAAQA,EAAE,CAAA,CAAjDJ,CAAAA;EACAA,eAAe,CAACE,cAAhBF,GAAiC,EAAjCA;EAEA,OAAOA,eAAe,CAACC,MAAvB;AACD,CANM,CAQP;;AACO,SAASmC,wBAAT,CAAkCnC,MAAlC,EAA8D;EACnE,MAAMoC,OAAO,GAAGpC,MAAhB;EACA,MAAMqC,QAAQ,GAAG,CAAA,CAAjB;EAEA,KAAK,MAAMC,QAAX,IAAuBjC,iBAAvB,EAA0C;IACxC,IAAI,OAAO+B,OAAO,CAACE,QAAD,CAAd,KAA6B,QAAjC,EAA2C;MACzCD,QAAQ,CAACC,QAAD,CAARD,GAAqB7B,MAAM,CAAC+B,MAAP/B,CACnBgC,KAAK,CAACC,OAAND,CAAcJ,OAAO,CAACE,QAAD,CAArBE,CAAAA,GAAmC,EAAnCA,GAAwC,CAAA,CADrBhC,EAEnB4B,OAAO,CAACE,QAAD,CAFY9B,CAArB6B,CAGE;MACF;IACD;IAEDA,QAAQ,CAACC,QAAD,CAARD,GAAqBD,OAAO,CAACE,QAAD,CAA5BD;EACD,CAED;EACAA,QAAQ,CAACzB,MAATyB,GAAkB1B,QAAAA,CAAAA,OAAAA,CAAOC,MAAzByB;EAEA9B,gBAAgB,CAACM,OAAjBN,CAA0BO,KAAD,IAAW;IAClCuB,QAAQ,CAACvB,KAAD,CAARuB,GAAkB,CAAC,GAAGrB,IAAJ,KAAoB;MACpC,OAAOoB,OAAO,CAACtB,KAAD,CAAPsB,CAAe,GAAGpB,IAAlBoB,CAAP;IACD,CAFDC;EAGD,CAJD9B,CAAAA;EAMA,OAAO8B,QAAP;AACD","sourcesContent":["/* global window */\nimport React from 'react'\nimport Router, { NextRouter } from '../next-server/lib/router/router'\nimport { RouterContext } from '../next-server/lib/router-context'\n\ntype ClassArguments<T> = T extends new (...args: infer U) => any ? U : any\n\ntype RouterArgs = ClassArguments<typeof Router>\n\ntype SingletonRouterBase = {\n  router: Router | null\n  readyCallbacks: Array<() => any>\n  ready(cb: () => any): void\n}\n\nexport { Router, NextRouter }\n\nexport type SingletonRouter = SingletonRouterBase & NextRouter\n\nconst singletonRouter: SingletonRouterBase = {\n  router: null, // holds the actual router instance\n  readyCallbacks: [],\n  ready(cb: () => void) {\n    if (this.router) return cb()\n    if (typeof window !== 'undefined') {\n      this.readyCallbacks.push(cb)\n    }\n  },\n}\n\n// Create public properties and methods of the router in the singletonRouter\nconst urlPropertyFields = [\n  'pathname',\n  'route',\n  'query',\n  'asPath',\n  'components',\n  'isFallback',\n  'basePath',\n  'locale',\n  'locales',\n  'defaultLocale',\n]\nconst routerEvents = [\n  'routeChangeStart',\n  'beforeHistoryChange',\n  'routeChangeComplete',\n  'routeChangeError',\n  'hashChangeStart',\n  'hashChangeComplete',\n]\nconst coreMethodFields = [\n  'push',\n  'replace',\n  'reload',\n  'back',\n  'prefetch',\n  'beforePopState',\n]\n\n// Events is a static property on the router, the router doesn't have to be initialized to use it\nObject.defineProperty(singletonRouter, 'events', {\n  get() {\n    return Router.events\n  },\n})\n\nurlPropertyFields.forEach((field) => {\n  // Here we need to use Object.defineProperty because, we need to return\n  // the property assigned to the actual router\n  // The value might get changed as we change routes and this is the\n  // proper way to access it\n  Object.defineProperty(singletonRouter, field, {\n    get() {\n      const router = getRouter() as any\n      return router[field] as string\n    },\n  })\n})\n\ncoreMethodFields.forEach((field) => {\n  // We don't really know the types here, so we add them later instead\n  ;(singletonRouter as any)[field] = (...args: any[]) => {\n    const router = getRouter() as any\n    return router[field](...args)\n  }\n})\n\nrouterEvents.forEach((event) => {\n  singletonRouter.ready(() => {\n    Router.events.on(event, (...args) => {\n      const eventField = `on${event.charAt(0).toUpperCase()}${event.substring(\n        1\n      )}`\n      const _singletonRouter = singletonRouter as any\n      if (_singletonRouter[eventField]) {\n        try {\n          _singletonRouter[eventField](...args)\n        } catch (err) {\n          console.error(`Error when running the Router event: ${eventField}`)\n          console.error(`${err.message}\\n${err.stack}`)\n        }\n      }\n    })\n  })\n})\n\nfunction getRouter(): Router {\n  if (!singletonRouter.router) {\n    const message =\n      'No router instance found.\\n' +\n      'You should only use \"next/router\" inside the client side of your app.\\n'\n    throw new Error(message)\n  }\n  return singletonRouter.router\n}\n\n// Export the singletonRouter and this is the public API.\nexport default singletonRouter as SingletonRouter\n\n// Reexport the withRoute HOC\nexport { default as withRouter } from './with-router'\n\nexport function useRouter(): NextRouter {\n  return React.useContext(RouterContext)\n}\n\n// INTERNAL APIS\n// -------------\n// (do not use following exports inside the app)\n\n// Create a router and assign it as the singleton instance.\n// This is used in client side when we are initilizing the app.\n// This should **not** use inside the server.\nexport const createRouter = (...args: RouterArgs): Router => {\n  singletonRouter.router = new Router(...args)\n  singletonRouter.readyCallbacks.forEach((cb) => cb())\n  singletonRouter.readyCallbacks = []\n\n  return singletonRouter.router\n}\n\n// This function is used to create the `withRouter` router instance\nexport function makePublicRouterInstance(router: Router): NextRouter {\n  const _router = router as any\n  const instance = {} as any\n\n  for (const property of urlPropertyFields) {\n    if (typeof _router[property] === 'object') {\n      instance[property] = Object.assign(\n        Array.isArray(_router[property]) ? [] : {},\n        _router[property]\n      ) // makes sure query is not stateful\n      continue\n    }\n\n    instance[property] = _router[property]\n  }\n\n  // Events is a static property on the router, the router doesn't have to be initialized to use it\n  instance.events = Router.events\n\n  coreMethodFields.forEach((field) => {\n    instance[field] = (...args: any[]) => {\n      return _router[field](...args)\n    }\n  })\n\n  return instance\n}\n"]},"metadata":{},"sourceType":"script"}